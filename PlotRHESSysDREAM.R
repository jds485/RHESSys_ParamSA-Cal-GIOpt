#Load libraries----
library(BayesianTools)
library(parallel)
library(foreach)
library(iterators)
library(doParallel)
library(rlist)
library(EGRET)
library(vroom)
library(pracma)
library(coda)
library(bayesplot)
library(gridExtra)

#Set directories----
#dir_Ch39 = "C:\\Users\\js4yd\\OneDrive - University of Virginia\\BES_Data\\BES_Data\\RHESSysFiles\\BR&POBR\\Calibration\\Ch39"
dir_Ch10 = "C:\\Users\\js4yd\\OneDrive - University of Virginia\\BES_Data\\BES_Data\\RHESSysFiles\\BR&POBR\\Calibration\\Ch10"
dir_Ch10_1 = "C:\\Users\\js4yd\\OneDrive - University of Virginia\\BES_Data\\BES_Data\\RHESSysFiles\\BR&POBR\\Calibration\\Ch10-1"
dir_Ch10_2 = "C:\\Users\\js4yd\\OneDrive - University of Virginia\\BES_Data\\BES_Data\\RHESSysFiles\\BR&POBR\\Calibration\\Ch10-2"
dir_Ch10_3 = "C:\\Users\\js4yd\\OneDrive - University of Virginia\\BES_Data\\BES_Data\\RHESSysFiles\\BR&POBR\\Calibration\\Ch10-3"

dir_sCh10 = "C:\\Users\\js4yd\\OneDrive - University of Virginia\\BES_Data\\BES_Data\\RHESSysFiles\\BR&POBR\\Calibration\\SynCh10"
dir_sCh10_1 = "C:\\Users\\js4yd\\OneDrive - University of Virginia\\BES_Data\\BES_Data\\RHESSysFiles\\BR&POBR\\Calibration\\SynCh10-1"
dir_sCh10_2 = "C:\\Users\\js4yd\\OneDrive - University of Virginia\\BES_Data\\BES_Data\\RHESSysFiles\\BR&POBR\\Calibration\\SynCh10-2"
dir_sCh10_3 = "C:\\Users\\js4yd\\OneDrive - University of Virginia\\BES_Data\\BES_Data\\RHESSysFiles\\BR&POBR\\Calibration\\SynCh10-3"

#39 Chains----
#setwd(dir_Ch39)
#load(file = paste0(dir_Ch39, '/OutputWorkspace.RData'), verbose = FALSE)
#rm(cl, Info, startValues, i, tic_Script)

# Plot and summarize output----
#Fixme: this requires cores to be setup to run in parallel, with all of the exported variables.
#summary(out_Parext)

#print(out_Parext_Restart$settings$runtime)
#summary(out_Parext_Restart)
#print(out_Parext_Restart_1$settings$runtime)
#summary(out_Parext_Restart_1)

#Useful to see the prior and posterior on same plot.
#PriorSample = prior$sampler(n = 50000)
#png('marginalplot_39_1-16.png', res = 300, units = 'in', width = 7, height = 7)
#marginalPlot(x = out_Parext$chain[,1:16], prior = PriorSample[,1:16])
#dev.off()
#png('marginalplot_39_17-32.png', res = 300, units = 'in', width = 7, height = 7)
#marginalPlot(x = out_Parext$chain[,17:32], prior = PriorSample[,17:32])
#dev.off()
#png('marginalplot_39_33-42.png', res = 300, units = 'in', width = 7, height = 7)
#marginalPlot(x = out_Parext$chain[,33:42], prior = PriorSample[,33:42])
#dev.off()

#Only for last 50 chain steps
#png('marginalplot_39_1-16_l50.png', res = 300, units = 'in', width = 7, height = 7)
#marginalPlot(x = out_Parext$chain[51:100,1:16], prior = PriorSample[,1:16])
#dev.off()
#png('marginalplot_39_17-32_l50.png', res = 300, units = 'in', width = 7, height = 7)
#marginalPlot(x = out_Parext$chain[51:100,17:32], prior = PriorSample[,17:32])
#dev.off()
#png('marginalplot_39_33-42_l50.png', res = 300, units = 'in', width = 7, height = 7)
#marginalPlot(x = out_Parext$chain[51:100,33:42], prior = PriorSample[,33:42])
#dev.off()

#scatterplot matrix (mcmc_pairs in bayesplot is alternative)
#Fixme: Not sure how is best to view this scatterplot matrix because there are too many parameters to view in one grid.
# use whichParameters() for converged sets, and for the most sensitive parameters
#png('corplot_39.png', res = 300, units = 'in', width = 14, height = 14)
#correlationPlot(mat = out_Parext, scaleCorText = TRUE)
#dev.off()

#png('pairs_39.png', res = 300, units = 'in', width = 10, height = 10)
#mcmc_pairs(out_Parext$chain[,1:10])
#dev.off()

#Trace plots with posterior density for all parameter values - chains should look similar, not get stuck
# png('traceplot_39_1-4.png', res = 300, units = 'in', width = 7, height = 7)
# plot(out_Parext$chain[,1:4], smooth = FALSE)
# dev.off()
# png('traceplot_39_5-8.png', res = 300, units = 'in', width = 7, height = 7)
# plot(out_Parext$chain[,5:8], smooth = FALSE)
# dev.off()
# png('traceplot_39_9-12.png', res = 300, units = 'in', width = 7, height = 7)
# plot(out_Parext$chain[,9:12], smooth = FALSE)
# dev.off()
# png('traceplot_39_13-16.png', res = 300, units = 'in', width = 7, height = 7)
# plot(out_Parext$chain[,13:16], smooth = FALSE)
# dev.off()
# png('traceplot_39_17-20.png', res = 300, units = 'in', width = 7, height = 7)
# plot(out_Parext$chain[,17:20], smooth = FALSE)
# dev.off()
# png('traceplot_39_21-24.png', res = 300, units = 'in', width = 7, height = 7)
# plot(out_Parext$chain[,21:24], smooth = FALSE)
# dev.off()
# png('traceplot_39_25-28.png', res = 300, units = 'in', width = 7, height = 7)
# plot(out_Parext$chain[,25:28], smooth = FALSE)
# dev.off()
# png('traceplot_39_29-32.png', res = 300, units = 'in', width = 7, height = 7)
# plot(out_Parext$chain[,29:32], smooth = FALSE)
# dev.off()
# png('traceplot_39_33-36.png', res = 300, units = 'in', width = 7, height = 7)
# plot(out_Parext$chain[,33:36], smooth = FALSE)
# dev.off()
# png('traceplot_39_37-40.png', res = 300, units = 'in', width = 7, height = 7)
# plot(out_Parext$chain[,37:40], smooth = FALSE)
# dev.off()
# png('traceplot_39_41-42.png', res = 300, units = 'in', width = 7, height = 7)
# plot(out_Parext$chain[,41:42], smooth = FALSE)
# dev.off()

#mcmc_trace in bayesplot as alternative traceplots
# png('traceplot_39_1-9_b.png', res = 300, units = 'in', width = 7, height = 7)
# mcmc_trace(out_Parext$chain[,1:9])
# dev.off()
# png('traceplot_39_10-18_b.png', res = 300, units = 'in', width = 7, height = 7)
# mcmc_trace(out_Parext$chain[,10:18])
# dev.off()
# png('traceplot_39_19-27_b.png', res = 300, units = 'in', width = 7, height = 7)
# mcmc_trace(out_Parext$chain[,19:27])
# dev.off()
# png('traceplot_39_28-36_b.png', res = 300, units = 'in', width = 7, height = 7)
# mcmc_trace(out_Parext$chain[,28:36])
# dev.off()
# png('traceplot_39_veg_b.png', res = 300, units = 'in', width = 7, height = 7)
# mcmc_trace(out_Parext$chain[,34:42])
# dev.off()

#Fixme: This requires cores to be setup to run in parallel
#png('gelmanplot_30.png', res = 300, units = 'in', width = 7, height = 7)
#gelmanDiagnostics(sampler = out_Parext, plot = TRUE)
#dev.off()
#png('diagnosticplot_30.png', res = 300, units = 'in', width = 7, height = 7)
#plotDiagnostic(out = out_Parext)
#dev.off()

#stopCluster(cl)

# Run convergence diagnostics----
#R-hat - Gelman-Rubin within and between chain variance for all variables - target less than 1.05 for all
#gelman.diag(out_Parext$chain[,1:42])
#Autocorrelation of chain for each parameter should drop quickly. This informs the amound of values to skip in MCMC
# png('AutocorrPlot_39_1-9.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,1:9], lag.max = 10)
# dev.off()
# png('AutocorrPlot_39_10-18.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,10:18], lag.max = 10)
# dev.off()
# png('AutocorrPlot_39_19-27.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,19:27], lag.max = 10)
# dev.off()
# png('AutocorrPlot_39_28-36.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,28:36], lag.max = 10)
# dev.off()
# png('AutocorrPlot_39_veg.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,34:42], lag.max = 10)
# dev.off()

#Last 50 steps - function doesn't like this
# png('AutocorrPlot_39_1-9_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,1:9], lag.max = 10)
# dev.off()
# png('AutocorrPlot_39_10-18_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,10:18], lag.max = 10)
# dev.off()
# png('AutocorrPlot_39_19-27_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,19:27], lag.max = 10)
# dev.off()
# png('AutocorrPlot_39_28-36_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,28:36], lag.max = 10)
# dev.off()
# png('AutocorrPlot_39_veg_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,34:42], lag.max = 10)
# dev.off()


#Stationarity of chain - Geweke
#Computed for individual chains
# png('GewekePlot_39_1-9.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,1:9])
# dev.off()
# png('GewekePlot_39_10-18.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,10:18])
# dev.off()
# png('GewekePlot_39_19-27.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,19:27])
# dev.off()
# png('GewekePlot_39_28-36.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,28:36])
# dev.off()
# png('GewekePlot_39_veg.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,34:42])
# dev.off()

#need at least 50 chain steps for this
#gelman.plot(x, bin.width = 10, max.bins = 50, confidence = 0.95, transform = FALSE, autoburnin=TRUE, auto.layout = TRUE, ask, col, lty, xlab, ylab, type, ...)

#Parallel coordinate plot - including all parameters is a bit much.
# png('parcoord_39.png', res = 300, units = 'in', width = 10, height = 5)
# mcmc_parcoord(outParext$chain, transform = function(x) {(x - min(x)) / (max(x)-min(x))})
# dev.off()

#Density overlay (mcmc_dens_overlay) - all chains should have similar densities for each variable
# png('densOverlay_39.png', res = 300, units = 'in', width = 10, height = 10)
# mcmc_dens_overlay(out_Parext$chain)
# dev.off()

#Rejection Rate
#Reject_Ch39 = coda::rejectionRate(out_Parext$chain)

#Highest Posterior Density Interval
#HPDs_Ch39 = coda::HPDinterval(out_Parext$chain)
#HPDs_Ch39_bt = BayesianTools::getCredibleIntervals(out_Parext$chain[[1]])

#Effective sample size for each parameter should be similar
#EffSize_Ch39 = coda::effectiveSize(out_Parext$chain)

# Accept/Reject rates for each chain----
#AR = read.table('AcceptReject_c.txt', header=TRUE)
#ARrates = vector('numeric', length = ncol(AR))
#for (i in 1:ncol(AR)){
#  ARrates[i] = sum(AR[,i])/nrow(AR)
#}
#png('AcceptRejectHist.png', res = 200, height=5, width=5, units='in')
#hist(ARrates, xlim=c(0,1))
#dev.off()

#Fixme: Check for runs of 0s in chains

# Likelihoods----
#LQ = read.csv('LikeParamsQ_c.csv', stringsAsFactors = FALSE)
#LTN = read.csv('LikeParamsTN_c.csv', stringsAsFactors = FALSE)
#Read observation timeseries
#obsQ = read.table("C:\\Users\\js4yd\\OneDrive - University of Virginia\\BES_Data\\BES_Data\\RHESSysFiles\\BR&POBR\\RHESSysFilePreparation\\obs\\BaismanStreamflow_Feb2020Revised_Cal.txt", stringsAsFactors = FALSE, sep = '\t', header=TRUE)
#obsQ = obsQ[which((as.Date(obsQ$Date) >= as.Date('2004-10-01')) & (as.Date(obsQ$Date) <= as.Date('2013-09-30'))),]
#obsTN = read.table("C:\\Users\\js4yd\\OneDrive - University of Virginia\\BES_Data\\BES_Data\\RHESSysFiles\\BR&POBR\\RHESSysFilePreparation\\obs\\TN_Feb2020Revised_Cal.txt", stringsAsFactors = FALSE, sep = '\t', header=TRUE)

#Fixme: histogram from chains, not from csv files.
#hist(LQ$logL/nrow(obsQ))

#Fixme: Parameter histograms for likelihoods from AnalyzeLikelihoods script

#10 Chains----
# Random seed----
set.seed(2077)
# Load Files----
setwd(dir_Ch10)
load(file = paste0(dir_Ch10, '/OutputWorkspace-10Ch.RData'), verbose = FALSE)
rm(cl, Info, i, arg, startValues, tic_Script)
out_Ch10_s100 = out_Parext
rm(out_Parext)
load(file = paste0(dir_Ch10, '/OutputWorkspace-10Ch_r.RData'), verbose = FALSE)
for (i in 1:length(out_Parext_Restart$chain)){
  colnames(out_Parext_Restart$chain[[i]]) = colnames(temp$chain[[1]])
}
rm(cl, Info, i, arg, temp)
out_Ch10_s200 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10, '/OutputWorkspace-10Ch_s300.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_s300 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10, '/OutputWorkspace-10Ch_s400.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_s400 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10, '/OutputWorkspace-10Ch_s500.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_s500 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10, '/OutputWorkspace-10Ch_s600.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_s600 = out_Parext_Restart
rm(out_Parext_Restart)

#  Remove the burnin from all greater than 500----
out_Ch10_s500$burnrm = out_Ch10_s500$chain[201:500,]
class(out_Ch10_s500$burnrm) = 'mcmc.list'
out_Ch10_s600$burnrm = out_Ch10_s600$chain[201:600,]
class(out_Ch10_s600$burnrm) = 'mcmc.list'

# Plot and summarize output----
#Fixme: this requires cores to be setup to run in parallel, with all of the exported variables.
#summary(out_Parext)

#  Marginals - Useful to see the prior and posterior on same plot.----
PriorSample = prior$sampler(n = 50000)
png('marginalplot_10_atm_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s100$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s100$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s100$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s100$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s100$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s200$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s200$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s200$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s200$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s200$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s300$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s300$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s300$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s300$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s300$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s400$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s400$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s400$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s400$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s400$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s500$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s500$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s500$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s500$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s500$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

#Only for last 50 chain steps
png('marginalplot_10_atm_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$chain[551:600,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$chain[551:600,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$chain[551:600,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$chain[551:600,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$chain[551:600,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

#Removing the first 200 (burnin)
png('marginalplot_10_atm_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s500$burnrm[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s500$burnrm[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s500$burnrm[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s500$burnrm[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s500$burnrm[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$burnrm[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$burnrm[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$burnrm[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$burnrm[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_s600$burnrm[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()


#  scatterplot matrix----
#Not sure how is best to view this scatterplot matrix because there are too many parameters to view in one grid.
png('corplot_10_atm_s500.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s500$burnrm, scaleCorText = TRUE, whichParameters = c(2:6, 1, 33))
dev.off()
png('corplot_10_s8GW_s500.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s500$burnrm, scaleCorText = TRUE, whichParameters = c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26, 1, 33))
dev.off()
png('corplot_10_s9GW_s500.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s500$burnrm, scaleCorText = TRUE, whichParameters = c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21, 10, 12, 18, 20, 1, 33))
dev.off()
png('corplot_10_veg_s500.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s500$burnrm, scaleCorText = TRUE, whichParameters = c(34:42, 1,33))
dev.off()
#More converged parameters
png('corplot_10_conv_s500.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s500$burnrm, scaleCorText = TRUE, whichParameters = c())
dev.off()
#Most sensitive parameters
png('corplot_10_sens_s500.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s500$burnrm, scaleCorText = TRUE, whichParameters = c(34:42, 1,33))
dev.off()

png('corplot_10_atm_s600.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s600$burnrm, scaleCorText = TRUE, whichParameters = c(2:6, 1, 33))
dev.off()
png('corplot_10_s8GW_s600.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s600$burnrm, scaleCorText = TRUE, whichParameters = c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26, 1, 33))
dev.off()
png('corplot_10_s9GW_s600.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s600$burnrm, scaleCorText = TRUE, whichParameters = c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21, 10, 12, 18, 20, 1, 33))
dev.off()
png('corplot_10_veg_s600.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s600$burnrm, scaleCorText = TRUE, whichParameters = c(34:42, 1,33))
dev.off()
#More converged parameters
png('corplot_10_conv_s600.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s600$burnrm, scaleCorText = TRUE, whichParameters = c())
dev.off()
#Most sensitive parameters
png('corplot_10_sens_s600.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_Ch10_s600$burnrm, scaleCorText = TRUE, whichParameters = c(34:42, 1,33))
dev.off()

#mcmc_pairs in bayesplot is alternative method
#png('pairs_10.png', res = 300, units = 'in', width = 10, height = 10)
#mcmc_pairs(out_Ch10_s100$chain[,1:10])
#dev.off()

#  Trace plots with posterior density for all parameter values----
# chains should look similar, not get stuck
png('traceplot_10_1-4.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s100$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s100$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s100$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s100$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s100$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s100$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s100$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s100$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s100$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s100$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s100$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s200$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s200$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s200$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s200$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s200$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s200$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s200$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s200$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s200$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s200$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s200$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s300$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s300$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s300$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s300$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s300$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s300$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s300$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s300$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s300$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s300$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s300$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s400$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s400$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s400$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s400$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s400$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s400$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s400$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s400$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s400$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s400$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s400$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s500$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s500$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s500$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s500$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s500$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s500$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s500$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s500$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s500$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s500$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s500$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s600$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s600$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s600$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s600$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s600$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s600$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s600$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s600$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s600$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s600$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_s600$chain[,41:42], smooth = FALSE)
dev.off()

#mcmc_trace in bayesplot as alternative traceplots
# png('traceplot_10_1-9_b.png', res = 300, units = 'in', width = 7, height = 7)
# mcmc_trace(out_Ch10_s100$chain[,1:9])
# dev.off()
# png('traceplot_10_10-18_b.png', res = 300, units = 'in', width = 7, height = 7)
# mcmc_trace(out_Ch10_s100$chain[,10:18])
# dev.off()
# png('traceplot_10_19-27_b.png', res = 300, units = 'in', width = 7, height = 7)
# mcmc_trace(out_Ch10_s100$chain[,19:27])
# dev.off()
# png('traceplot_10_28-36_b.png', res = 300, units = 'in', width = 7, height = 7)
# mcmc_trace(out_Ch10_s100$chain[,28:36])
# dev.off()
# png('traceplot_10_veg_b.png', res = 300, units = 'in', width = 7, height = 7)
# mcmc_trace(out_Ch10_s100$chain[,34:42])
# dev.off()

#  Gelman Diagnostics----
#Fixme: This requires cores to be setup to run in parallel
#png('gelmanplot_10.png', res = 300, units = 'in', width = 7, height = 7)
#gelmanDiagnostics(sampler = out_Ch10_s100, plot = TRUE)
#dev.off()
#png('diagnosticplot_10.png', res = 300, units = 'in', width = 7, height = 7)
#plotDiagnostic(out = out_Ch10_s100)
#dev.off()

#stopCluster(cl)

# Run convergence diagnostics----
#R-hat - Gelman-Rubin within and between chain variance for all variables - target less than 1.05 for all
#gelman.diag(out_Ch10_s100$chain[,1:42])
#Autocorrelation of chain for each parameter should drop quickly. This informs the amount of values to skip in MCMC
#Fixme: this function plots individual chains. Would be good to average the autocorrelation for each chain and plot with error bars.
png('AutocorrPlot_10_1-9.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s100$chain[,1:9], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_10-18.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s100$chain[,10:18], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_19-27.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s100$chain[,19:27], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_28-36.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s100$chain[,28:36], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_veg.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s100$chain[,34:42], lag.max = 10, ask = FALSE)
dev.off()

png('AutocorrPlot_10_1-9_s200.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s200$chain[,1:9], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_10-18_s200.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s200$chain[,10:18], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_19-27_s200.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s200$chain[,19:27], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_28-36_s200.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s200$chain[,28:36], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_veg_s200.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s200$chain[,34:42], lag.max = 10, ask = FALSE)
dev.off()

png('AutocorrPlot_10_1-9_s300.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s300$chain[,1:9], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_10-18_s300.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s300$chain[,10:18], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_19-27_s300.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s300$chain[,19:27], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_28-36_s300.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s300$chain[,28:36], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_veg_s300.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s300$chain[,34:42], lag.max = 10, ask = FALSE)
dev.off()

png('AutocorrPlot_10_1-9_s400.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s400$chain[,1:9], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_10-18_s400.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s400$chain[,10:18], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_19-27_s400.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s400$chain[,19:27], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_28-36_s400.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s400$chain[,28:36], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_veg_s400.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s400$chain[,34:42], lag.max = 10, ask = FALSE)
dev.off()

png('AutocorrPlot_10_1-9_s500.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s500$chain[,1:9], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_10-18_s500.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s500$chain[,10:18], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_19-27_s500.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s500$chain[,19:27], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_28-36_s500.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s500$chain[,28:36], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_veg_s500.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s500$chain[,34:42], lag.max = 10, ask = FALSE)
dev.off()

png('AutocorrPlot_10_1-9_s600.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s600$chain[,1:9], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_10-18_s600.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s600$chain[,10:18], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_19-27_s600.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s600$chain[,19:27], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_28-36_s600.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s600$chain[,28:36], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_veg_s600.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s600$chain[,34:42], lag.max = 10, ask = FALSE)
dev.off()

#Burnin removed
png('AutocorrPlot_10_1-9_s500.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s500$burnrm[,1:9], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_10-18_s500.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s500$burnrm[,10:18], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_19-27_s500.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s500$burnrm[,19:27], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_28-36_s500.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s500$burnrm[,28:36], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_veg_s500.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s500$burnrm[,34:42], lag.max = 10, ask = FALSE)
dev.off()

png('AutocorrPlot_10_1-9_s600.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s600$burnrm[,1:9], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_10-18_s600.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s600$burnrm[,10:18], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_19-27_s600.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s600$burnrm[,19:27], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_28-36_s600.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s600$burnrm[,28:36], lag.max = 10, ask = FALSE)
dev.off()
png('AutocorrPlot_10_veg_s600.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Ch10_s600$burnrm[,34:42], lag.max = 10, ask = FALSE)
dev.off()

#Stationarity of chain - Geweke
#Fixme: This is computed for individual chains. code to loop in first figure
# png('GewekePlot_10_1-9.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Ch10_s100$chain[,1:9])
# coda::geweke.plot(as.mcmc(out_Ch10_s300$chain[[1]][150:300,1:9]))
# dev.off()
# png('GewekePlot_10_10-18.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Ch10_s100$chain[,10:18])
# dev.off()
# png('GewekePlot_10_19-27.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Ch10_s100$chain[,19:27])
# dev.off()
# png('GewekePlot_10_28-36.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Ch10_s100$chain[,28:36])
# dev.off()
# png('GewekePlot_10_veg.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Ch10_s100$chain[,34:42])
# dev.off()

#need at least 50 chain steps for this
gelman.plot(x = out_Ch10_s400$chain[,-c(43,44,45)], autoburnin = TRUE, ylim = c(0,2), ask=FALSE)
gelman.plot(x = out_Ch10_s500$chain[,-c(43,44,45)], autoburnin = TRUE, ylim = c(0,2), ask=FALSE)
gelman.plot(x = out_Ch10_s600$chain[,-c(43,44,45)], autoburnin = TRUE, ylim = c(0,2), ask=FALSE)
#Burning removed
gelman.plot(x = out_Ch10_s500$burnrm[,-c(43,44,45)], autoburnin = TRUE, ylim = c(0,2), ask=FALSE)
gelman.plot(x = out_Ch10_s600$burnrm[,-c(43,44,45)], autoburnin = TRUE, ylim = c(0,2), ask=FALSE)

#Parallel coordinate plot - including all parameters is a bit much.
#png('parcoord_10.png', res = 300, units = 'in', width = 10, height = 5)
#mcmc_parcoord(outParext$chain, transform = function(x) {(x - min(x)) / (max(x)-min(x))})
#dev.off()

#Density overlay (mcmc_dens_overlay) - all chains should have similar densities for each variable
png('densOverlay_10_s100.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_Ch10_s100$chain)
dev.off()
png('densOverlay_10_s200.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_Ch10_s200$chain)
dev.off()
png('densOverlay_10_s300.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_Ch10_s300$chain)
dev.off()
png('densOverlay_10_s400.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_Ch10_s400$chain)
dev.off()
png('densOverlay_10_s500.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_Ch10_s500$chain)
dev.off()
png('densOverlay_10_s600.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_Ch10_s600$chain)
dev.off()
#Burnin Removed
png('densOverlay_10_s500b.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_Ch10_s500$burnrm)
dev.off()
png('densOverlay_10_s600b.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_Ch10_s600$burnrm)
dev.off()

#Rejection Rate
Reject_Ch10_s100 = coda::rejectionRate(out_Ch10_s100$chain)
Reject_Ch10_s200 = coda::rejectionRate(out_Ch10_s200$chain)
Reject_Ch10_s300 = coda::rejectionRate(out_Ch10_s300$chain)
Reject_Ch10_s400 = coda::rejectionRate(out_Ch10_s400$chain)
Reject_Ch10_s500 = coda::rejectionRate(out_Ch10_s500$chain)
Reject_Ch10_s600 = coda::rejectionRate(out_Ch10_s600$chain)
#Burnin Removed
Reject_Ch10_s500r = coda::rejectionRate(out_Ch10_s500$chain)
Reject_Ch10_s600r = coda::rejectionRate(out_Ch10_s600$chain)

#Highest Posterior Density Interval
HPDs_Ch10 = coda::HPDinterval(out_Ch10_s600$chain)
HPDs_Ch10_bt = BayesianTools::getCredibleIntervals(out_Ch10_s600$chain[[1]])

#Effective sample size for each parameter should be similar
EffSize_Ch10 = coda::effectiveSize(out_Ch10_s600$chain)

# Accept/Reject rates for each chain----
AR_Ch10_s100 = read.table('AcceptReject_c.txt', header=TRUE)
AR_Ch10_s200 = read.table('AcceptReject_c_s200.txt', header=TRUE)
AR_Ch10_s300 = read.table('AcceptReject_c_s300.txt', header=TRUE)
AR_Ch10_s400 = read.table('AcceptReject_c_s400.txt', header=TRUE)
AR_Ch10_s500 = read.table('AcceptReject_c_s500.txt', header=TRUE)
AR_Ch10_s600 = read.table('AcceptReject_c_s600.txt', header=TRUE)
#Join into one
AR_Ch10 = rbind(AR_Ch10_s100, AR_Ch10_s200, AR_Ch10_s300, AR_Ch10_s400, AR_Ch10_s500, AR_Ch10_s600)
rm(AR_Ch10_s100, AR_Ch10_s200, AR_Ch10_s300, AR_Ch10_s400, AR_Ch10_s500, AR_Ch10_s600)

ARrates_Ch10 = vector('numeric', length = ncol(AR_Ch10))
for (i in 1:ncol(AR_Ch10)){
  ARrates_Ch10[i] = sum(AR_Ch10[,i])/nrow(AR_Ch10)
}

png('AcceptRejectHist.png', res = 200, height=5, width=5, units='in')
hist(ARrates_Ch10, xlim=c(0,1))
dev.off()

#10 Chains - Ch1----
# Random seed----
set.seed(2078)
# Load Files----
setwd(dir_Ch10_1)
load(file = paste0(dir_Ch10_1, '/OutputWorkspace-10Ch-1.RData'), verbose = FALSE)
out_Ch10_1_s100 = out_Parext
rm(cl, Info, i, arg, startValues, tic_Script, out_Parext)
load(file = paste0(dir_Ch10_1, '/OutputWorkspace-10Ch-1_r.RData'), verbose = FALSE)
for (i in 1:length(out_Parext_Restart$chain)){
  colnames(out_Parext_Restart$chain[[i]]) = colnames(temp$chain[[1]])
}
rm(cl, Info, i, arg, temp)
out_Ch10_1_s200 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10_1, '/OutputWorkspace-10Ch-1_s300.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_1_s300 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10_1, '/OutputWorkspace-10Ch-1_s400.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_1_s400 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10_1, '/OutputWorkspace-10Ch-1_s500.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_1_s500 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10_1, '/OutputWorkspace-10Ch-1_s600.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_1_s600 = out_Parext_Restart
rm(out_Parext_Restart)

#  Remove the burnin from all greater than 500----
out_Ch10_1_s500$burnrm = out_Ch10_1_s500$chain[201:500,]
class(out_Ch10_1_s500$burnrm) = 'mcmc.list'
out_Ch10_1_s600$burnrm = out_Ch10_1_s600$chain[201:600,]
class(out_Ch10_1_s600$burnrm) = 'mcmc.list'

# Plot and summarize output----
#Fixme: this requires cores to be setup to run in parallel, with all of the exported variables.
#summary(out_Parext)

#  Marginals - Useful to see the prior and posterior on same plot----
PriorSample = prior$sampler(n = 50000)
png('marginalplot_10_atm_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s100$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s100$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s100$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s100$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s100$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s200$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s200$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s200$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s200$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s200$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s300$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s300$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s300$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s300$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s300$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s400$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s400$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s400$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s400$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s400$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s500$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s500$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s500$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s500$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s500$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

#Only for last 50 chain steps
png('marginalplot_10_atm_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$chain[551:600,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$chain[551:600,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$chain[551:600,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$chain[551:600,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$chain[551:600,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

#Removing the first 200 (burnin)
png('marginalplot_10_atm_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s500$burnrm[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s500$burnrm[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s500$burnrm[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s500$burnrm[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s500$burnrm[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$burnrm[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$burnrm[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$burnrm[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$burnrm[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_1_s600$burnrm[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

#  scatterplot matrix----
#Not sure how is best to view this scatterplot matrix because there are too many parameters to view in one grid.
#png('corplot_10.png', res = 300, units = 'in', width = 14, height = 14)
#correlationPlot(mat = out_Parext, scaleCorText = TRUE)
#dev.off()

#png('pairs_10.png', res = 300, units = 'in', width = 10, height = 10)
#mcmc_pairs(out_Parext$chain[,1:10])
#dev.off()

#  Trace plots with posterior density for all parameter values----
# chains should look similar, not get stuck
png('traceplot_10_1-4.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s100$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s100$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s100$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s100$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s100$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s100$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s100$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s100$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s100$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s100$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s100$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s200$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s200$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s200$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s200$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s200$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s200$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s200$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s200$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s200$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s200$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s200$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s300$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s300$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s300$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s300$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s300$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s300$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s300$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s300$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s300$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s300$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s300$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s400$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s400$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s400$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s400$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s400$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s400$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s400$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s400$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s400$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s400$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s400$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s500$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s500$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s500$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s500$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s500$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s500$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s500$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s500$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s500$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s500$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s500$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s600$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s600$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s600$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s600$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s600$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s600$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s600$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s600$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s600$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s600$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_1_s600$chain[,41:42], smooth = FALSE)
dev.off()

#  Gelman Diagnostics----
#Fixme: This requires cores to be setup to run in parallel
#png('gelmanplot_10.png', res = 300, units = 'in', width = 7, height = 7)
#gelmanDiagnostics(sampler = out_Parext, plot = TRUE)
#dev.off()
#png('diagnosticplot_10.png', res = 300, units = 'in', width = 7, height = 7)
#plotDiagnostic(out = out_Parext)
#dev.off()

#stopCluster(cl)

# Run convergence diagnostics----
#R-hat - Gelman-Rubin within and between chain variance for all variables - target less than 1.05 for all
#gelman.diag(out_Parext$chain[,1:42])
#Autocorrelation of chain for each parameter should drop quickly. This informs the amound of values to skip in MCMC
png('AutocorrPlot_10_1-9.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,1:9], lag.max = 10)
dev.off()
png('AutocorrPlot_10_10-18.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,10:18], lag.max = 10)
dev.off()
png('AutocorrPlot_10_19-27.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,19:27], lag.max = 10)
dev.off()
png('AutocorrPlot_10_28-36.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,28:36], lag.max = 10)
dev.off()
png('AutocorrPlot_10_veg.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,34:42], lag.max = 10)
dev.off()


#Stationarity of chain - Geweke
#Fixme: This is computed for individual chains
# png('GewekePlot_10_1-9.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,1:9])
# dev.off()
# png('GewekePlot_10_10-18.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,10:18])
# dev.off()
# png('GewekePlot_10_19-27.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,19:27])
# dev.off()
# png('GewekePlot_10_28-36.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,28:36])
# dev.off()
# png('GewekePlot_10_veg.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,34:42])
# dev.off()

#need at least 50 chain steps for this
#gelman.plot(x, bin.width = 10, max.bins = 50, confidence = 0.95, transform = FALSE, autoburnin=TRUE, auto.layout = TRUE, ask, col, lty, xlab, ylab, type, ...)

#Parallel coordinate plot - including all parameters is a bit much.
png('parcoord_10.png', res = 300, units = 'in', width = 10, height = 5)
mcmc_parcoord(outParext$chain, transform = function(x) {(x - min(x)) / (max(x)-min(x))})
dev.off()

#Density overlay (mcmc_dens_overlay) - all chains should have similar densities for each variable
png('densOverlay_10.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_Parext$chain)
dev.off()

#Rejection Rate
Reject_Ch10 = coda::rejectionRate(out_Parext$chain)

#Highest Posterior Density Interval
HPDs_Ch10 = coda::HPDinterval(out_Parext$chain)
HPDs_Ch10_bt = BayesianTools::getCredibleIntervals(out_Parext$chain[[1]])

#Effective sample size for each parameter should be similar
EffSize_Ch10 = coda::effectiveSize(out_Parext$chain)

# Accept/Reject rates for each chain----
AR_Ch10_1_s100 = read.table('AcceptReject_c.txt', header=TRUE)
AR_Ch10_1_s200 = read.table('AcceptReject_c_s200.txt', header=TRUE)
AR_Ch10_1_s300 = read.table('AcceptReject_c_s300.txt', header=TRUE)
AR_Ch10_1_s400 = read.table('AcceptReject_c_s400.txt', header=TRUE)
AR_Ch10_1_s500 = read.table('AcceptReject_c_s500.txt', header=TRUE)
AR_Ch10_1_s600 = read.table('AcceptReject_c_s600.txt', header=TRUE)
#Join into one
AR_Ch10_1 = rbind(AR_Ch10_1_s100, AR_Ch10_1_s200, AR_Ch10_1_s300, AR_Ch10_1_s400, AR_Ch10_1_s500, AR_Ch10_1_s600)
rm(AR_Ch10_1_s100, AR_Ch10_1_s200, AR_Ch10_1_s300, AR_Ch10_1_s400, AR_Ch10_1_s500, AR_Ch10_1_s600)

ARrates_Ch10_1 = vector('numeric', length = ncol(AR_Ch10_1))
for (i in 1:ncol(AR_Ch10_1)){
  ARrates_Ch10_1[i] = sum(AR_Ch10_1[,i])/nrow(AR_Ch10_1)
}

png('AcceptRejectHist.png', res = 200, height=5, width=5, units='in')
hist(ARrates_Ch10_1, xlim=c(0,1))
dev.off()

#10 Chains - Ch2----
# Random seed----
set.seed(2079)
# Load Files----
setwd(dir_Ch10_2)
load(file = paste0(dir_Ch10_2, '/OutputWorkspace-10Ch-2.RData'), verbose = FALSE)
out_Ch10_2_s100 = out_Parext
rm(cl, Info, i, arg, startValues, tic_Script, out_Parext)
load(file = paste0(dir_Ch10_2, '/OutputWorkspace-10Ch-2_r.RData'), verbose = FALSE)
for (i in 1:length(out_Parext_Restart$chain)){
  colnames(out_Parext_Restart$chain[[i]]) = colnames(temp$chain[[1]])
}
out_Ch10_2_s200 = out_Parext_Restart
rm(cl, Info, i, arg, temp, out_Parext_Restart)
load(file = paste0(dir_Ch10_2, '/OutputWorkspace-10Ch-2_s300.RData'), verbose = FALSE)
out_Ch10_2_s300 = out_Parext_Restart
rm(cl, Info, i, arg, temp, out_Parext_Restart)
load(file = paste0(dir_Ch10_2, '/OutputWorkspace-10Ch-2_s400.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_2_s400 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10_2, '/OutputWorkspace-10Ch-2_s500.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_2_s500 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10_2, '/OutputWorkspace-10Ch-2_s600.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_2_s600 = out_Parext_Restart
rm(out_Parext_Restart)

#  Remove the burnin from all greater than 500----
out_Ch10_2_s500$burnrm = out_Ch10_2_s500$chain[201:500,]
class(out_Ch10_2_s500$burnrm) = 'mcmc.list'
out_Ch10_2_s600$burnrm = out_Ch10_2_s600$chain[201:600,]
class(out_Ch10_2_s600$burnrm) = 'mcmc.list'

# Plot and summarize output----
#Fixme: this requires cores to be setup to run in parallel, with all of the exported variables.
#summary(out_Parext)

#  Marginals - Useful to see the prior and posterior on same plot----
PriorSample = prior$sampler(n = 50000)
png('marginalplot_10_atm_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s100$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s100$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s100$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s100$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s100$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s200$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s200$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s200$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s200$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s200$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s300$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s300$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s300$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s300$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s300$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s400$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s400$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s400$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s400$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s400$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s500$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s500$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s500$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s500$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s500$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

#Only for last 50 chain steps
png('marginalplot_10_atm_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$chain[551:600,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$chain[551:600,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$chain[551:600,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$chain[551:600,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$chain[551:600,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

#Removing the first 200 (burnin)
png('marginalplot_10_atm_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s500$burnrm[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s500$burnrm[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s500$burnrm[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s500$burnrm[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s500$burnrm[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$burnrm[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$burnrm[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$burnrm[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$burnrm[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_2_s600$burnrm[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

#  scatterplot matrix----
#Not sure how is best to view this scatterplot matrix because there are too many parameters to view in one grid.
#png('corplot_10.png', res = 300, units = 'in', width = 14, height = 14)
#correlationPlot(mat = out_Parext, scaleCorText = TRUE)
#dev.off()

#png('pairs_10.png', res = 300, units = 'in', width = 10, height = 10)
#mcmc_pairs(out_Parext$chain[,1:10])
#dev.off()

#  Trace plots with posterior density for all parameter values----
png('traceplot_10_1-4.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s100$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s100$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s100$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s100$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s100$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s100$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s100$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s100$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s100$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s100$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s100$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s200$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s200$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s200$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s200$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s200$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s200$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s200$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s200$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s200$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s200$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s200$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s300$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s300$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s300$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s300$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s300$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s300$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s300$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s300$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s300$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s300$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s300$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s400$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s400$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s400$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s400$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s400$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s400$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s400$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s400$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s400$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s400$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s400$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s500$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s500$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s500$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s500$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s500$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s500$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s500$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s500$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s500$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s500$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s500$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s600$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s600$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s600$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s600$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s600$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s600$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s600$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s600$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s600$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s600$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_2_s600$chain[,41:42], smooth = FALSE)
dev.off()

#  Gelman Diagnostics----
#Fixme: This requires cores to be setup to run in parallel
#png('gelmanplot_10.png', res = 300, units = 'in', width = 7, height = 7)
#gelmanDiagnostics(sampler = out_Parext, plot = TRUE)
#dev.off()
#png('diagnosticplot_10.png', res = 300, units = 'in', width = 7, height = 7)
#plotDiagnostic(out = out_Parext)
#dev.off()

#stopCluster(cl)

# Run convergence diagnostics----
#R-hat - Gelman-Rubin within and between chain variance for all variables - target less than 1.05 for all
#gelman.diag(out_Parext$chain[,1:42])
#Autocorrelation of chain for each parameter should drop quickly. This informs the amound of values to skip in MCMC
png('AutocorrPlot_10_1-9.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,1:9], lag.max = 10)
dev.off()
png('AutocorrPlot_10_10-18.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,10:18], lag.max = 10)
dev.off()
png('AutocorrPlot_10_19-27.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,19:27], lag.max = 10)
dev.off()
png('AutocorrPlot_10_28-36.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,28:36], lag.max = 10)
dev.off()
png('AutocorrPlot_10_veg.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,34:42], lag.max = 10)
dev.off()

#Last 50 steps - function doesn't like this
# png('AutocorrPlot_10_1-9_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,1:9], lag.max = 10)
# dev.off()
# png('AutocorrPlot_10_10-18_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,10:18], lag.max = 10)
# dev.off()
# png('AutocorrPlot_10_19-27_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,19:27], lag.max = 10)
# dev.off()
# png('AutocorrPlot_10_28-36_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,28:36], lag.max = 10)
# dev.off()
# png('AutocorrPlot_10_veg_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,34:42], lag.max = 10)
# dev.off()


#Stationarity of chain - Geweke
#Fixme: This is computed for individual chains
# png('GewekePlot_10_1-9.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,1:9])
# dev.off()
# png('GewekePlot_10_10-18.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,10:18])
# dev.off()
# png('GewekePlot_10_19-27.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,19:27])
# dev.off()
# png('GewekePlot_10_28-36.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,28:36])
# dev.off()
# png('GewekePlot_10_veg.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,34:42])
# dev.off()

#need at least 50 chain steps for this
#gelman.plot(x, bin.width = 10, max.bins = 50, confidence = 0.95, transform = FALSE, autoburnin=TRUE, auto.layout = TRUE, ask, col, lty, xlab, ylab, type, ...)

#Parallel coordinate plot - including all parameters is a bit much.
png('parcoord_10.png', res = 300, units = 'in', width = 10, height = 5)
mcmc_parcoord(outParext$chain, transform = function(x) {(x - min(x)) / (max(x)-min(x))})
dev.off()

#Density overlay (mcmc_dens_overlay) - all chains should have similar densities for each variable
png('densOverlay_10.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_Parext$chain)
dev.off()

#Rejection Rate
Reject_Ch10 = coda::rejectionRate(out_Parext$chain)

#Highest Posterior Density Interval
HPDs_Ch10 = coda::HPDinterval(out_Parext$chain)
HPDs_Ch10_bt = BayesianTools::getCredibleIntervals(out_Parext$chain[[1]])

#Effective sample size for each parameter should be similar
EffSize_Ch10 = coda::effectiveSize(out_Parext$chain)

# Accept/Reject rates for each chain----
AR_Ch10_2_s100 = read.table('AcceptReject_c.txt', header=TRUE)
AR_Ch10_2_s200 = read.table('AcceptReject_c_s200.txt', header=TRUE)
AR_Ch10_2_s300 = read.table('AcceptReject_c_s300.txt', header=TRUE)
AR_Ch10_2_s400 = read.table('AcceptReject_c_s400.txt', header=TRUE)
AR_Ch10_2_s500 = read.table('AcceptReject_c_s500.txt', header=TRUE)
AR_Ch10_2_s600 = read.table('AcceptReject_c_s600.txt', header=TRUE)
#Join into one
AR_Ch10_2 = rbind(AR_Ch10_2_s100, AR_Ch10_2_s200, AR_Ch10_2_s300, AR_Ch10_2_s400, AR_Ch10_2_s500, AR_Ch10_2_s600)
rm(AR_Ch10_2_s100, AR_Ch10_2_s200, AR_Ch10_2_s300, AR_Ch10_2_s400, AR_Ch10_2_s500, AR_Ch10_2_s600)

ARrates_Ch10_2 = vector('numeric', length = ncol(AR_Ch10_2))
for (i in 1:ncol(AR_Ch10_2)){
  ARrates_Ch10_2[i] = sum(AR_Ch10_2[,i])/nrow(AR_Ch10_2)
}

png('AcceptRejectHist.png', res = 200, height=5, width=5, units='in')
hist(ARrates_Ch10_2, xlim=c(0,1))
dev.off()


#10 Chains - Ch3----
# Random seed----
set.seed(2080)
# Load Files----
setwd(dir_Ch10_3)
load(file = paste0(dir_Ch10_3, '/OutputWorkspace-10Ch-3.RData'), verbose = FALSE)
out_Ch10_3_s100 = out_Parext
rm(cl, Info, i, arg, startValues, tic_Script, out_Parext)
load(file = paste0(dir_Ch10_3, '/OutputWorkspace-10Ch-3_r.RData'), verbose = FALSE)
for (i in 1:length(out_Parext_Restart$chain)){
  colnames(out_Parext_Restart$chain[[i]]) = colnames(temp$chain[[1]])
}
out_Ch10_3_s200 = out_Parext_Restart
rm(cl, Info, i, arg, temp, out_Parext_Restart)
load(file = paste0(dir_Ch10_3, '/OutputWorkspace-10Ch-3_s300.RData'), verbose = FALSE)
out_Ch10_3_s300 = out_Parext_Restart
rm(cl, Info, i, arg, temp, out_Parext_Restart)
load(file = paste0(dir_Ch10_3, '/OutputWorkspace-10Ch-3_s400.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_3_s400 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10_3, '/OutputWorkspace-10Ch-3_s500.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_3_s500 = out_Parext_Restart
rm(out_Parext_Restart)
load(file = paste0(dir_Ch10_3, '/OutputWorkspace-10Ch-3_s600.RData'), verbose = FALSE)
rm(cl, Info, i, arg, temp)
out_Ch10_3_s600 = out_Parext_Restart
rm(out_Parext_Restart)

#  Remove the burnin from all greater than 500----
out_Ch10_3_s500$burnrm = out_Ch10_3_s500$chain[201:500,]
class(out_Ch10_3_s500$burnrm) = 'mcmc.list'
out_Ch10_3_s600$burnrm = out_Ch10_3_s600$chain[201:600,]
class(out_Ch10_3_s600$burnrm) = 'mcmc.list'

# Plot and summarize output----
#Fixme: this requires cores to be setup to run in parallel, with all of the exported variables.
#summary(out_Parext)

#  Marginals - Useful to see the prior and posterior on same plot----
PriorSample = prior$sampler(n = 50000)
png('marginalplot_10_atm_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s100$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s100$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s100$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s100$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s100$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s200$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s200$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s200$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s200.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s200$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s100.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s200$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s300$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s300$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s300$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s300$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s300.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s300$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s400$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s400$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s400$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s400$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s400$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s500$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s500$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s500$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s500$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s500.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s500$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$chain[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$chain[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$chain[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$chain[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s600.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$chain[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

#Only for last 50 chain steps
png('marginalplot_10_atm_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$chain[551:600,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$chain[551:600,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$chain[551:600,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$chain[551:600,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_l50.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$chain[551:600,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

#Removing the first 200 (burnin)
png('marginalplot_10_atm_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s500$burnrm[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s500$burnrm[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s500$burnrm[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s500$burnrm[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s500_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s500$burnrm[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

png('marginalplot_10_atm_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$burnrm[,2:6], prior = PriorSample[,2:6], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s8_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$burnrm[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], prior = PriorSample[,c(23, 28, 29, 32, 24, 25, 30, 27, 31, 26)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$burnrm[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], prior = PriorSample[,c(7, 14, 15, 22, 8, 9, 16, 17, 11, 13, 19, 21)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9GW_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$burnrm[,c(1,10,12,33,18,20)], prior = PriorSample[,c(1,10,12,33,18,20)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s600_brm.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_Ch10_3_s600$burnrm[,34:42], prior = PriorSample[,34:42], singlePanel = FALSE)
dev.off()

#  scatterplot matrix----
#Not sure how is best to view this scatterplot matrix because there are too many parameters to view in one grid.
#png('corplot_10.png', res = 300, units = 'in', width = 14, height = 14)
#correlationPlot(mat = out_Parext, scaleCorText = TRUE)
#dev.off()

#png('pairs_10.png', res = 300, units = 'in', width = 10, height = 10)
#mcmc_pairs(out_Parext$chain[,1:10])
#dev.off()

#  Trace plots with posterior density for all parameter values----
png('traceplot_10_1-4.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s100$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s100$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s100$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s100$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s100$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s100$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s100$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s100$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s100$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s100$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s100$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s200$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s200$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s200$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s200$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s200$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s200$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s200$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s200$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s200$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s200$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s200.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s200$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s300$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s300$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s300$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s300$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s300$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s300$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s300$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s300$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s300$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s300$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s300.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s300$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s400$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s400$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s400$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s400$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s400$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s400$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s400$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s400$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s400$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s400$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s400.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s400$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s500$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s500$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s500$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s500$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s500$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s500$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s500$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s500$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s500$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s500$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s500.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s500$chain[,41:42], smooth = FALSE)
dev.off()

png('traceplot_10_1-4_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s600$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s600$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s600$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s600$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-20_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s600$chain[,17:20], smooth = FALSE)
dev.off()
png('traceplot_10_21-24_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s600$chain[,21:24], smooth = FALSE)
dev.off()
png('traceplot_10_25-28_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s600$chain[,25:28], smooth = FALSE)
dev.off()
png('traceplot_10_29-32_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s600$chain[,29:32], smooth = FALSE)
dev.off()
png('traceplot_10_33-36_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s600$chain[,33:36], smooth = FALSE)
dev.off()
png('traceplot_10_37-40_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s600$chain[,37:40], smooth = FALSE)
dev.off()
png('traceplot_10_41-42_s600.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_Ch10_3_s600$chain[,41:42], smooth = FALSE)
dev.off()

#  Gelman Diagnostics----
#Fixme: This requires cores to be setup to run in parallel
#png('gelmanplot_10.png', res = 300, units = 'in', width = 7, height = 7)
#gelmanDiagnostics(sampler = out_Parext, plot = TRUE)
#dev.off()
#png('diagnosticplot_10.png', res = 300, units = 'in', width = 7, height = 7)
#plotDiagnostic(out = out_Parext)
#dev.off()

#stopCluster(cl)

# Run convergence diagnostics----
#R-hat - Gelman-Rubin within and between chain variance for all variables - target less than 1.05 for all
#gelman.diag(out_Parext$chain[,1:42])
#Autocorrelation of chain for each parameter should drop quickly. This informs the amound of values to skip in MCMC
png('AutocorrPlot_10_1-9.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,1:9], lag.max = 10)
dev.off()
png('AutocorrPlot_10_10-18.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,10:18], lag.max = 10)
dev.off()
png('AutocorrPlot_10_19-27.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,19:27], lag.max = 10)
dev.off()
png('AutocorrPlot_10_28-36.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,28:36], lag.max = 10)
dev.off()
png('AutocorrPlot_10_veg.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_Parext$chain[,34:42], lag.max = 10)
dev.off()

#Last 50 steps - function doesn't like this
# png('AutocorrPlot_10_1-9_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,1:9], lag.max = 10)
# dev.off()
# png('AutocorrPlot_10_10-18_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,10:18], lag.max = 10)
# dev.off()
# png('AutocorrPlot_10_19-27_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,19:27], lag.max = 10)
# dev.off()
# png('AutocorrPlot_10_28-36_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,28:36], lag.max = 10)
# dev.off()
# png('AutocorrPlot_10_veg_l50.png', res = 300, units = 'in', width = 7, height = 7)
# coda::autocorr.plot(out_Parext$chain[,34:42], lag.max = 10)
# dev.off()


#Stationarity of chain - Geweke
#Fixme: This is computed for individual chains
# png('GewekePlot_10_1-9.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,1:9])
# dev.off()
# png('GewekePlot_10_10-18.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,10:18])
# dev.off()
# png('GewekePlot_10_19-27.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,19:27])
# dev.off()
# png('GewekePlot_10_28-36.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,28:36])
# dev.off()
# png('GewekePlot_10_veg.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_Parext$chain[,34:42])
# dev.off()

#need at least 50 chain steps for this
#gelman.plot(x, bin.width = 10, max.bins = 50, confidence = 0.95, transform = FALSE, autoburnin=TRUE, auto.layout = TRUE, ask, col, lty, xlab, ylab, type, ...)

#Parallel coordinate plot - including all parameters is a bit much.
png('parcoord_10.png', res = 300, units = 'in', width = 10, height = 5)
mcmc_parcoord(outParext$chain, transform = function(x) {(x - min(x)) / (max(x)-min(x))})
dev.off()

#Density overlay (mcmc_dens_overlay) - all chains should have similar densities for each variable
png('densOverlay_10.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_Parext$chain)
dev.off()

#Rejection Rate
Reject_Ch10 = coda::rejectionRate(out_Parext$chain)

#Highest Posterior Density Interval
HPDs_Ch10 = coda::HPDinterval(out_Parext$chain)
HPDs_Ch10_bt = BayesianTools::getCredibleIntervals(out_Parext$chain[[1]])

#Effective sample size for each parameter should be similar
EffSize_Ch10 = coda::effectiveSize(out_Parext$chain)

# Accept/Reject rates for each chain----
AR_Ch10_3_s100 = read.table('AcceptReject_c.txt', header=TRUE)
AR_Ch10_3_s200 = read.table('AcceptReject_c_s200.txt', header=TRUE)
AR_Ch10_3_s300 = read.table('AcceptReject_c_s300.txt', header=TRUE)
AR_Ch10_3_s400 = read.table('AcceptReject_c_s400.txt', header=TRUE)
AR_Ch10_3_s500 = read.table('AcceptReject_c_s500.txt', header=TRUE)
AR_Ch10_3_s600 = read.table('AcceptReject_c_s600.txt', header=TRUE)
#Join into one
AR_Ch10_3 = rbind(AR_Ch10_3_s100, AR_Ch10_3_s200, AR_Ch10_3_s300, AR_Ch10_3_s400, AR_Ch10_3_s500, AR_Ch10_3_s600)
rm(AR_Ch10_3_s100, AR_Ch10_3_s200, AR_Ch10_3_s300, AR_Ch10_3_s400, AR_Ch10_3_s500, AR_Ch10_3_s600)

ARrates_Ch10_3 = vector('numeric', length = ncol(AR_Ch10_3))
for (i in 1:ncol(AR_Ch10_3)){
  ARrates_Ch10_3[i] = sum(AR_Ch10_3[,i])/nrow(AR_Ch10_3)
}

png('AcceptRejectHist.png', res = 200, height=5, width=5, units='in')
hist(ARrates_Ch10_3, xlim=c(0,1))
dev.off()
#########Synthetic Hillslope 9+10################ 
#10 Chains----
# Random seed----
set.seed(7256)
# Load Files----
setwd(dir_sCh10)
load(file = paste0(dir_sCh10, '/OutputWorkspace-10Ch_s400.RData'), verbose = FALSE)
rm(cl, Info, i, arg, startValues, tic_Script)
out_sCh10_s400 = out_Parext
rm(out_Parext)

#  Remove the burnin----
#out_Ch10_s500$burnrm = out_Ch10_s500$chain[201:500,]
#class(out_Ch10_s500$burnrm) = 'mcmc.list'

# Plot and summarize output----
#Fixme: this requires cores to be setup to run in parallel, with all of the exported variables.
#summary(out_Parext)

#  Marginals - Useful to see the prior and posterior on same plot.----
PriorSample = prior$sampler(n = 50000)
png('marginalplot_10_atm_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_sCh10_s400$chain[,c(12,2)], prior = PriorSample[,c(12,2)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_s9_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_sCh10_s400$chain[,c(3, 8, 9, 15, 4, 5, 10, 11, 6, 7, 13, 14)], prior = PriorSample[,c(3, 8, 9, 15, 4, 5, 10, 11, 6, 7, 13, 14)], singlePanel = FALSE)
dev.off()
png('marginalplot_10_veg_s400.png', res = 300, units = 'in', width = 7, height = 7)
marginalPlot(x = out_sCh10_s400$chain[,c(1, 16:19)], prior = PriorSample[,c(1, 16:19)], singlePanel = FALSE)
dev.off()


#Only for last 50 chain steps

#Removing the first 200 (burnin)

#  scatterplot matrix----
#Not sure how is best to view this scatterplot matrix because there are too many parameters to view in one grid.
png('corplot_10_atm_s400.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_sCh10_s400$chain, scaleCorText = TRUE, whichParameters = c(12,2))
dev.off()
png('corplot_10_veg_s400.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_sCh10_s400$chain, scaleCorText = TRUE, whichParameters = c(34:42, 1,33))
dev.off()
#More converged parameters
png('corplot_10_conv_s400.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_sCh10_s400$chain, scaleCorText = TRUE, whichParameters = c())
dev.off()
#Most sensitive parameters
png('corplot_10_sens_s400.png', res = 300, units = 'in', width = 14, height = 14)
correlationPlot(mat = out_sCh10_s400$chain, scaleCorText = TRUE, whichParameters = c(34:42, 1,33))
dev.off()

#mcmc_pairs in bayesplot is alternative method
#png('pairs_10.png', res = 300, units = 'in', width = 10, height = 10)
#mcmc_pairs(out_sCh10_s400$chain[,1:10])
#dev.off()

#  Trace plots with posterior density for all parameter values----
# chains should look similar, not get stuck
png('traceplot_10_1-4.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_sCh10_s400$chain[,1:4], smooth = FALSE)
dev.off()
png('traceplot_10_5-8.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_sCh10_s400$chain[,5:8], smooth = FALSE)
dev.off()
png('traceplot_10_9-12.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_sCh10_s400$chain[,9:12], smooth = FALSE)
dev.off()
png('traceplot_10_13-16.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_sCh10_s400$chain[,13:16], smooth = FALSE)
dev.off()
png('traceplot_10_17-19.png', res = 300, units = 'in', width = 7, height = 7)
plot(out_sCh10_s400$chain[,17:19], smooth = FALSE)
dev.off()

#mcmc_trace in bayesplot as alternative traceplots
# png('traceplot_10_1-9_b.png', res = 300, units = 'in', width = 7, height = 7)
# mcmc_trace(out_sCh10_s400$chain[,1:9])
# dev.off()


#  Gelman Diagnostics----
#Fixme: This requires cores to be setup to run in parallel
#png('gelmanplot_10.png', res = 300, units = 'in', width = 7, height = 7)
#gelmanDiagnostics(sampler = out_sCh10_s400, plot = TRUE)
#dev.off()
#png('diagnosticplot_10.png', res = 300, units = 'in', width = 7, height = 7)
#plotDiagnostic(out = out_sCh10_s400)
#dev.off()

#stopCluster(cl)

# Run convergence diagnostics----
#R-hat - Gelman-Rubin within and between chain variance for all variables - target less than 1.05 for all
#gelman.diag(out_sCh10_s400$chain[,1:42])
#Autocorrelation of chain for each parameter should drop quickly. This informs the amount of values to skip in MCMC
#Fixme: this function plots individual chains. Would be good to average the autocorrelation for each chain and plot with error bars.
png('AutocorrPlot_10_1-9.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_sCh10_s400$chain[,1:9], lag.max = 100, ask = FALSE)
dev.off()
png('AutocorrPlot_10_10-18.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_sCh10_s400$chain[,10:18], lag.max = 100, ask = FALSE)
dev.off()
png('AutocorrPlot_10_19.png', res = 300, units = 'in', width = 7, height = 7)
coda::autocorr.plot(out_sCh10_s400$chain[,19], lag.max = 100, ask = FALSE)
dev.off()

#Burnin removed


#Stationarity of chain - Geweke
#Fixme: This is computed for individual chains. code to loop in first figure
# png('GewekePlot_10_1-9.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_sCh10_s400$chain[,1:9])
# coda::geweke.plot(as.mcmc(out_Ch10_s300$chain[[1]][150:300,1:9]))
# dev.off()
# png('GewekePlot_10_10-18.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_sCh10_s400$chain[,10:18])
# dev.off()
# png('GewekePlot_10_19-27.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_sCh10_s400$chain[,19:27])
# dev.off()
# png('GewekePlot_10_28-36.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_sCh10_s400$chain[,28:36])
# dev.off()
# png('GewekePlot_10_veg.png', res = 300, units = 'in', width = 7, height = 7)
# coda::geweke.plot(out_sCh10_s400$chain[,34:42])
# dev.off()

#need at least 50 chain steps for this
gelman.plot(x = out_sCh10_s400$chain[,-c(20,21,22)], autoburnin = TRUE, ylim = c(0,10))

#Burning removed

#Parallel coordinate plot - including all parameters is a bit much.
#png('parcoord_10.png', res = 300, units = 'in', width = 10, height = 5)
#mcmc_parcoord(outParext$chain, transform = function(x) {(x - min(x)) / (max(x)-min(x))})
#dev.off()

#Density overlay (mcmc_dens_overlay) - all chains should have similar densities for each variable
png('densOverlay_10_s400.png', res = 300, units = 'in', width = 10, height = 10)
mcmc_dens_overlay(out_sCh10_s400$chain)
dev.off()

#Burnin Removed

#Rejection Rate
Reject_sCh10_s400 = coda::rejectionRate(out_sCh10_s400$chain)
#Burnin Removed

#Highest Posterior Density Interval
HPDs_Ch10 = coda::HPDinterval(out_Ch10_s600$chain)
HPDs_Ch10_bt = BayesianTools::getCredibleIntervals(out_Ch10_s600$chain[[1]])

#Effective sample size for each parameter should be similar
EffSize_sCh10 = coda::effectiveSize(out_sCh10_s400$chain)

# Accept/Reject rates for each chain----
AR_Ch10_s400 = read.table('AcceptReject_c_s400.txt', header=TRUE)

#Join into one
#AR_Ch10 = rbind(AR_Ch10_s400, AR_Ch10_s200, AR_Ch10_s300, AR_Ch10_s400, AR_Ch10_s500, AR_Ch10_s600)
#rm(AR_Ch10_s400, AR_Ch10_s200, AR_Ch10_s300, AR_Ch10_s400, AR_Ch10_s500, AR_Ch10_s600)

ARrates_Ch10 = vector('numeric', length = ncol(AR_Ch10))
for (i in 1:ncol(AR_Ch10)){
  ARrates_Ch10[i] = sum(AR_Ch10[,i])/nrow(AR_Ch10)
}

png('AcceptRejectHist.png', res = 200, height=5, width=5, units='in')
hist(ARrates_Ch10, xlim=c(0,1))
dev.off()

#Posterior Predictive Checks----
#Generate data from the parameter joint posterior distribution
# compare to the calibrated observations (X and yRep), and/or to future values (XTilde and yTilde)
# The true distribution of y should be similar to that of yRep.
#  Look at density overlay of y and yRep for each of the parameter sets

# Create a prediction function
#createPredictions <- function(par){
  # set the parameters that are not calibrated on default values 
#  x = refPars$best
#  x[parSel] = par
#  predicted <- VSEM(x[1:11], PAR) # replace here VSEM with your model 
#  return(predicted[,1] * 1000)
#}

# Create an error function
#createError <- function(mean, par){
#  return(rnorm(length(mean), mean = mean, sd = par[7]))
#}

# plot prior predictive distribution and prior predictive simulations
#plotTimeSeriesResults(sampler = out, model = createPredictions, observed = obs[,1],
#                      error = createError, prior = TRUE, main = "Prior predictive")

# plot posterior predictive distribution and posterior predictive simulations
#plotTimeSeriesResults(sampler = out, model = createPredictions, observed = obs[,1],
#                      error = createError, main = "Posterior predictive")

#% of observations within %-level prediction intervals
#autocorrelation for time series data 
#Bayesian p-values for evaluating model fit over the entire posterior distribution

#Credible intervals as barplots and as areas (mcmc_areas and mcmc_intervals)

#Extract the maximum likelihood value
#Loop over datasets and chains
MaxLikes = matrix(NA, nrow = 40, ncol = ncol(out_Ch10_3_s600$chain[[1]])+3)
for (ch in 1:10){
  MaxLikes[ch,1] = 0
  MaxLikes[ch,2] = ch
  MaxLikes[ch,3] = which(out_Ch10_s600$chain[[ch]][,43] == max(out_Ch10_s600$chain[[ch]][,43]))[1]
  MaxLikes[ch,-c(1,2,3)] = out_Ch10_s600$chain[[ch]][which(out_Ch10_s600$chain[[ch]][,43] == max(out_Ch10_s600$chain[[ch]][,43]))[1],]
}
for (ch in 11:20){
  MaxLikes[ch,1] = 1
  MaxLikes[ch,2] = ch-10
  MaxLikes[ch,3] = which(out_Ch10_1_s600$chain[[ch-10]][,43] == max(out_Ch10_1_s600$chain[[ch-10]][,43]))[1]
  MaxLikes[ch,-c(1,2,3)] = out_Ch10_1_s600$chain[[ch-10]][which(out_Ch10_1_s600$chain[[ch-10]][,43] == max(out_Ch10_1_s600$chain[[ch-10]][,43]))[1],]
}
for (ch in 21:30){
  MaxLikes[ch,1] = 2
  MaxLikes[ch,2] = ch-20
  MaxLikes[ch,3] = which(out_Ch10_2_s600$chain[[ch-20]][,43] == max(out_Ch10_2_s600$chain[[ch-20]][,43]))[1]
  MaxLikes[ch,-c(1,2,3)] = out_Ch10_2_s600$chain[[ch-20]][which(out_Ch10_2_s600$chain[[ch-20]][,43] == max(out_Ch10_2_s600$chain[[ch-20]][,43]))[1],]
}
for (ch in 31:40){
  MaxLikes[ch,1] = 3
  MaxLikes[ch,2] = ch-30
  MaxLikes[ch,3] = which(out_Ch10_3_s600$chain[[ch-30]][,43] == max(out_Ch10_3_s600$chain[[ch-30]][,43]))[1]
  MaxLikes[ch,-c(1,2,3)] = out_Ch10_3_s600$chain[[ch-30]][which(out_Ch10_3_s600$chain[[ch-30]][,43] == max(out_Ch10_3_s600$chain[[ch-30]][,43]))[1],]
}

MaxLikes[MaxLikes[,46] == max(MaxLikes[,46]),]
